{% extends "guardhouse/master.html" %}
{% load static %}

{% block links %}
    <script src="{% static 'guardhouse_not_confirmed_visits.js' %}" type="module"></script>
{% endblock %}

{% block title %}
    Niepotwierdzone wizyty
{% endblock %}

{% block header %}
    Niepotwierdzone wizyty
{% endblock %}

{% block content %}

<div class="container-fluid mt-4">
    <div id="main-content" {% if not_confirmed_arrivals|length < 1 %}style="display:none;"{% endif %}>
        <div id="filters" class="row g-2 mb-4">
            <div class="col-lg-4">
                <input id="firstname-filter" type="text" class="form-control" placeholder="Wpisz imię">
            </div>
            <div class="col-lg-4">
                <input id="lastname-filter" type="text" class="form-control" placeholder="Wpisz nazwisko">
            </div>
            <div class="col-lg-4">
                <input id="company-filter" type="text" class="form-control" placeholder="Wpisz firmę">
            </div>
        </div>

        <form method="post" onsubmit="return confirmVisitsConfirmationPopup();">
            {% csrf_token %}

            <!-- Popup form -->
            <div id="end-form-popup" class="popup p-4 border rounded bg-light mb-3" style="display:none; max-width: 400px;">
                <div class="mb-3">
                    <label for="register_nb" class="form-label">Numer rejestracyjny (opcjonalnie)</label>
                    <input type="text" name="register_nb" class="form-control">
                </div>
                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-success">Akceptuj</button>
                    <button id="close-end-popup-button" type="button" class="btn btn-outline-danger">Anuluj</button>
                </div>
            </div>

            <button id="show-end-popup-button" type="button" class="btn btn-secondary w-100 mb-3">Potwierdź wizyty</button>

            <div id="arrivals" class="table-responsive">
                <table id="arrivals-table" class="table table-striped align-middle w-100">
                    <thead class="table-dark">
                        <tr>
                            <th>Imię Nazwisko</th>
                            <th>Firma</th>
                            <th>Cel przybycia</th>
                            <th>Osoby odpowiedzialne</th>
                            <th>Potwierdzić wizytę?</th>
                        </tr>
                    </thead>
                    <tbody id="arrivals-table-body">
                        {% for arrival in not_confirmed_arrivals %}
                            <tr>
                                <td>{{ arrival.name }}</td>
                                <td>{{ arrival.company }}</td>
                                <td>{{ arrival.description }}</td>
                                <td>
                                    {% for host in arrival.hosts %}
                                        <p class="mb-0">{{ host.name }}</p>
                                    {% endfor %}
                                </td>
                                <td>
                                    <!-- miejsce na checkbox/js lub inne elementy do zaznaczania -->
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </form>
    </div>

    <div id="no-data-info" class="text-center mt-4" {% if not_confirmed_arrivals|length > 0 %}style="display:none;"{% endif %}>
        <h4 class="text-muted">Brak rekordów do wyświetlenia</h4>
        <a href="{% url 'guardhouse-add-guest' %}" class="btn btn-outline-primary mt-2">Utwórz nową wizytę</a>
    </div>

</div>

{{ not_confirmed_arrivals|json_script:"not_confirmed_arrivals_json" }}
{% endblock %}
